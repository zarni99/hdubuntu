#!/bin/bash
# Manual Verification Commands - Ubuntu Server Hardening
# Use these commands to manually verify specific hardening measures

echo "============================================================"
echo "Manual Verification Commands for Ubuntu Server Hardening"
echo "============================================================"
echo ""

echo "üîç STEP 1: Operating System Hardening"
echo "----------------------------------------"
echo "# Check system updates:"
echo "apt list --upgradable"
echo ""
echo "# Check unattended upgrades:"
echo "cat /etc/apt/apt.conf.d/50unattended-upgrades"
echo ""
echo "# Check timezone and NTP:"
echo "timedatectl status"
echo ""

echo "üîç STEP 2: User and SSH Hardening"
echo "----------------------------------------"
echo "# Check created users:"
echo "cat /etc/passwd | grep -E '(admin1|admin2|admin3)'"
echo ""
echo "# Check SSH configuration:"
echo "sudo sshd -T | grep -E '(permitrootlogin|passwordauthentication|permitemptypasswords|x11forwarding|maxauthtries)'"
echo ""
echo "# Check SSH service status:"
echo "systemctl status ssh"
echo ""
echo "# Check password policies:"
echo "cat /etc/security/pwquality.conf | grep -v '^#' | grep -v '^$'"
echo ""

echo "üîç STEP 3: Firewall and Network Security"
echo "----------------------------------------"
echo "# Check UFW status:"
echo "sudo ufw status verbose"
echo ""
echo "# Check disabled services:"
echo "systemctl list-unit-files | grep -E '(avahi-daemon|cups|bluetooth)'"
echo ""
echo "# Check listening ports:"
echo "ss -tuln"
echo ""

echo "üîç STEP 4: Kernel and Sysctl Hardening"
echo "----------------------------------------"
echo "# Check current sysctl values:"
echo "sysctl net.ipv4.ip_forward"
echo "sysctl net.ipv4.conf.all.rp_filter"
echo "sysctl net.ipv4.conf.all.accept_source_route"
echo "sysctl net.ipv6.conf.all.disable_ipv6"
echo "sysctl kernel.kptr_restrict"
echo "sysctl kernel.dmesg_restrict"
echo "sysctl fs.protected_hardlinks"
echo "sysctl fs.protected_symlinks"
echo ""
echo "# Check persistent sysctl configuration:"
echo "cat /etc/sysctl.d/99-hardening.conf"
echo ""

echo "üîç STEP 5: Auditing and Logging"
echo "----------------------------------------"
echo "# Check auditd status:"
echo "systemctl status auditd"
echo ""
echo "# Check auditd configuration:"
echo "cat /etc/audit/auditd.conf | grep -E '(max_log_file|num_logs|space_left_action)'"
echo ""
echo "# Check audit rules:"
echo "sudo auditctl -l"
echo ""
echo "# Check recent audit events:"
echo "sudo ausearch -ts today | head -20"
echo ""
echo "# Check audit log files:"
echo "ls -la /var/log/audit/"
echo ""

echo "üîç GENERAL SYSTEM VERIFICATION"
echo "----------------------------------------"
echo "# Check system security status:"
echo "sudo aa-status  # AppArmor status"
echo ""
echo "# Check failed login attempts:"
echo "sudo journalctl _SYSTEMD_UNIT=ssh.service | grep 'Failed password'"
echo ""
echo "# Check system logs for errors:"
echo "sudo journalctl -p err -n 20"
echo ""
echo "# Check running processes:"
echo "ps aux --sort=-%cpu | head -10"
echo ""
echo "# Check network connections:"
echo "sudo netstat -tulpn"
echo ""
echo "# Check disk usage:"
echo "df -h"
echo ""
echo "# Check memory usage:"
echo "free -h"
echo ""

echo "============================================================"
echo "AUTOMATED VERIFICATION"
echo "============================================================"
echo "Run the automated verification script:"
echo "./verify_hardening.sh"
echo ""
echo "Or use make command:"
echo "make verify"
echo ""

echo "============================================================"
echo "COMPLIANCE REPORTING"
echo "============================================================"
echo "# Generate compliance report:"
echo "sudo lynis audit system --quick"
echo ""
echo "# Check CIS benchmark compliance (if available):"
echo "sudo cis-cat --benchmark CIS_Ubuntu_Linux_22.04_LTS_Benchmark_v1.0.0"
echo ""

echo "============================================================"
echo "MONITORING COMMANDS"
echo "============================================================"
echo "# Monitor audit logs in real-time:"
echo "sudo tail -f /var/log/audit/audit.log"
echo ""
echo "# Monitor system logs:"
echo "sudo journalctl -f"
echo ""
echo "# Monitor UFW logs:"
echo "sudo tail -f /var/log/ufw.log"
echo ""
echo "# Monitor SSH attempts:"
echo "sudo tail -f /var/log/auth.log | grep ssh"
echo ""